@{
    ViewData["Title"] = "Independent Project";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@model IEnumerable<IndependentProject.Models.Settlement>

<h2>Settlements</h2>
<hr/>
<ol>
    @foreach (var settlement in ViewBag.Settlements)
    {
        <li>
            <ul>
                <li>Refugee Camp : @settlement["name"]</li>
                <li>Country: @settlement.country</li>
                <li>Latitude: @settlement.latitude</li>
                <li>Longitude: @settlement.longitude</li>
                <li>pop: @foreach (var item in @settlement.population) {@item.value }</li>
                <li>Female Refugees Under 4: @ViewBag.FirstSettlementPop["04F"]</li>
            </ul>
        </li>

    }
</ol>

<div id="map-s"></div>

<script>
    google.charts.load('current', { 'packages': ['corechart'] });
      $(document).ready(function () {
            var map;

            function initialize() {
                var mapProp = {
                    center: new google.maps.LatLng(34.472922, 37.833789),
                    zoom: 5,
                    styles: [
            {
                "featureType": "all",
                "elementType": "labels",
                "stylers": [
                    {
                        "visibility": "off"
                    },
                    {
                        "lightness": 37
                    }
                ]
            },
            {
                "featureType": "administrative",
                "elementType": "all",
                "stylers": [
                    {
                        "visibility": "off"
                    }
                ]
            },
            {
                "featureType": "landscape",
                "elementType": "all",
                "stylers": [
                    {
                        "visibility": "off"
                    },
                    {
                        "hue": "#454440"
                    },
                    {
                        "saturation": -76
                    },
                    {
                        "lightness": 43
                    }
                ]
            },
            {
                "featureType": "landscape.man_made",
                "elementType": "all",
                "stylers": [
                    {
                        "visibility": "off"
                    }
                ]
            },
            {
                "featureType": "landscape.natural",
                "elementType": "all",
                "stylers": [
                    {
                        "visibility": "off"
                    }
                ]
            },
            {
                "featureType": "landscape.natural.landcover",
                "elementType": "all",
                "stylers": [
                    {
                        "visibility": "off"
                    }
                ]
            },
            {
                "featureType": "poi",
                "elementType": "all",
                "stylers": [
                    {
                        "visibility": "off"
                    }
                ]
            },
            {
                "featureType": "poi",
                "elementType": "labels",
                "stylers": [
                    {
                        "visibility": "off"
                    },
                    {
                        "lightness": 30
                    }
                ]
            },
            {
                "featureType": "poi.medical",
                "elementType": "all",
                "stylers": [
                    {
                        "visibility": "off"
                    }
                ]
            },
            {
                "featureType": "poi.park",
                "elementType": "all",
                "stylers": [
                    {
                        "visibility": "off"
                    },
                    {
                        "hue": "#50a10f"
                    }
                ]
            },
            {
                "featureType": "poi.school",
                "elementType": "all",
                "stylers": [
                    {
                        "visibility": "on"
                    }
                ]
            },
            {
                "featureType": "road",
                "elementType": "all",
                "stylers": [
                    {
                        "visibility": "off"
                    }
                ]
            },
            {
                "featureType": "road",
                "elementType": "labels",
                "stylers": [
                    {
                        "visibility": "off"
                    },
                    {
                        "hue": "#b8ab97"
                    },
                    {
                        "lightness": 29
                    }
                ]
            },
            {
                "featureType": "transit",
                "elementType": "all",
                "stylers": [
                    {
                        "visibility": "off"
                    }
                ]
            },
            {
                "featureType": "transit",
                "elementType": "labels",
                "stylers": [
                    {
                        "visibility": "on"
                    },
                    {
                        "lightness": 27
                    }
                ]
            },
            {
                "featureType": "transit",
                "elementType": "labels.text.stroke",
                "stylers": [
                    {
                        "visibility": "off"
                    }
                ]
            },
            {
                "featureType": "water",
                "elementType": "all",
                "stylers": [
                    {
                        "visibility": "on"
                    },
                    {
                        "color": "#c3c3c3"
                    },
                    {
                        "lightness": 13
                    }
                ]
            }
                    ]
                };
                map = new google.maps.Map(document.getElementById("map-s"), mapProp);

                var infowindow = new google.maps.InfoWindow({});
                $.getJSON('http://data.unhcr.org/api/population/regions.json?&instance_id=syria', function (json) {
                    $.each(json, function (key, data) {
                        var latLng = new google.maps.LatLng(parseFloat(data.latitude), parseFloat(data.longitude));
                        function drawChart(marker) {
                            var pieChart = new google.visualization.DataTable();
                            pieChart.addColumn('string', 'Refugees');
                            pieChart.addColumn('number', 'Demographcis');
                            pieChart.addRows([
                                ['Female under 5', parseFloat(data.population[0].demography["04F"])],
                                ['Female 5-11', parseFloat(data.population[0].demography["0511F"])],
                                ['Female 12-17', parseFloat(data.population[0].demography["1217F"])],
                                ['Female 18-59', parseFloat(data.population[0].demography["1859F"])],
                                ['Female 60+', parseFloat(data.population[0].demography["60F"])],
                                ['Male under 4', parseFloat(data.population[0].demography["04M"])],
                                ['Male 5-11', parseFloat(data.population[0].demography["0511M"])],
                                ['Male 12-17', parseFloat(data.population[0].demography["1217M"])],
                                ['Male 18-59', parseFloat(data.population[0].demography["1859M"])],
                                ['Male 60+', parseFloat(data.population[0].demography["60M"])]
                            ]);

                            var options = { title: 'Region: '+ data.name +  ' Total Refuge Population: ' + parseFloat(data.population[0].value),  width: 400, height: 300, pieSlizeText: 'label' };
                            var node = document.createElement('div'),
                                infoWindow = new google.maps.InfoWindow(),
                                chart = new google.visualization.PieChart(node);
                            chart.draw(pieChart, options);
                            infoWindow.setContent(node);
                            infoWindow.open(marker.getMap(), marker);

                        }

                        var marker1 = new google.maps.Marker({
                            position: latLng,
                            map: map
                           
                        });
                        
                        google.maps.event.addListener(marker1, 'click', function () {
                            drawChart(this);

                        });
                           
                    });
                });


            }

            
            google.maps.event.addDomListener(window, 'load', initialize);


        });
</script>